---
title: "TypeMock just totally rocks!"
layout: post
---
<p>Mocking frameworks are growing more and more in popularity these days, because to some degree Unit Testing, via TDD or otherwise, has been growing in popularity.&nbsp; This week at the <a href="http://www.heartlanddc.com/">Heartland Developer Conference</a> I gave a talk on what I call "practical" TDD.&nbsp; The talk goes over the basics of TDD quickly, but is really targeted at those who have tried to do TDD but found it difficult because they are not working on a team that has adopted the practice, or they are not working a project that was built to be testable.&nbsp; I spent a good bit of time working no what is the easiest path to help such people adopt TDD, because adoption of such good practices is far more important to me than perfection in them.&nbsp; As has been said many times, Good Enough is by definition, Good Enough.</p> <p>After a good bit of research on the subject of mocking frameworks, I have come to the simple conclusion that:</p> <ol> <li>This is an area that is growing still, as nearly every major framework differs on the coding approach.&nbsp; This is in stark contrast to testing frameworks which, to a one in .NET, all have settled on the NUnit 2.0 model of using attributes.</li> <li>That if you're not using TypeMock then you're just working to damned hard.</li></ol> <p>Now, I'm sure my friends (and there are many) who use Rhino Mocks will believe that I must be over-stating the issue, but I tell you clearly I am not.&nbsp; TypeMock is not built like any other mocking framework currently available, it uses the profiling APIs and not polymorphism or encapsulation in order to intercept calls and provide return values.&nbsp; Let me give you just a few examples of things which TypeMock can do in a few short lines of code which Rhino Mocks simply cannot do at all.</p> <p><strong>Mocking Static Methods</strong></p> <p>Take the following code, and assume that we wish to mock MessageBox.Show which is a static method:</p><pre class="csharpcode"><span class="kwrd">private</span> <span class="kwrd">void</span> MyCoolMethod(<span class="kwrd">string</span> msg){<span class="kwrd">if</span> (MessageBox.Show(msg) == DialogResult.OK)Console.WriteLine(<span class="str">"OK"</span>);<span class="kwrd">else</span>Console.WriteLine(<span class="str">"Not OK! Not OK!"</span>);}</pre><p><style type="text/css">.csharpcode, .csharpcode pre{	font-size: small;	color: black;	font-family: consolas, "Courier New", courier, monospace;	background-color: #ffffff;	/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {	background-color: #f4f4f4;	width: 100%;	margin: 0em;}.csharpcode .lnum { color: #606060; }</style>The following test will work perfectly to mock this call.&nbsp; No other hidden setup, nothing more than a reference to TypeMock.dll and the following code:</p><pre class="csharpcode">[Test]<span class="kwrd">public</span> <span class="kwrd">void</span> MockMessageBoxShow(){MockManager.Init();Mock mbMock = MockManager.Mock(<span class="kwrd">typeof</span>(MessageBox));mbMock.ExpectAndReturn(<span class="str">"Show"</span>, DialogResult.OK);MyCoolMethod(<span class="str">"Here we go again."</span>);<span class="rem">// Ensure that all expectations were met.</span>MockManager.Verify();}</pre><style type="text/css">.csharpcode, .csharpcode pre{	font-size: small;	color: black;	font-family: consolas, "Courier New", courier, monospace;	background-color: #ffffff;	/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {	background-color: #f4f4f4;	width: 100%;	margin: 0em;}.csharpcode .lnum { color: #606060; }</style><p>And with just that little code, just 4 lines dedicated to the mock, 2 of which should be refactored to Setup and TearDown methods, we can mock a static method.</p><p>Not cool enough for you? Ok, fine.</p><p><strong>Mocking Events</strong></p><p>So you have something which expects an object to return certain events.&nbsp; This example does require a professional license of&nbsp;TypeMock, it will not work under the Community Edition, but if you need this functionality then really&nbsp;pay the&nbsp;nice&nbsp;folks their money.</p><pre class="csharpcode"><span class="kwrd">public</span> <span class="kwrd">class</span> GUI{<span class="kwrd">public</span> <span class="kwrd">string</span> LovingCSharp { get; set; }<span class="kwrd">public</span> <span class="kwrd">void</span> Initialize(){<span class="kwrd">this</span>.LovingCSharp = <span class="kwrd">string</span>.Empty;Button button = <span class="kwrd">new</span> Button();button.Click += <span class="kwrd">new</span> EventHandler(button_Click);}<span class="kwrd">private</span> <span class="kwrd">void</span> button_Click(<span class="kwrd">object</span> sender, EventArgs e){<span class="kwrd">this</span>.LovingCSharp += <span class="str">"LOVE!"</span>;}}</pre><style type="text/css">.csharpcode, .csharpcode pre{	font-size: small;	color: black;	font-family: consolas, "Courier New", courier, monospace;	background-color: #ffffff;	/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {	background-color: #f4f4f4;	width: 100%;	margin: 0em;}.csharpcode .lnum { color: #606060; }</style><style type="text/css">.csharpcode, .csharpcode pre{	font-size: small;	color: black;	font-family: consolas, "Courier New", courier, monospace;	background-color: #ffffff;	/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {	background-color: #f4f4f4;	width: 100%;	margin: 0em;}.csharpcode .lnum { color: #606060; }</style><p>Now let's mock this up, call that event three times, and assert that our property is set correctly.&nbsp; </p><pre class="csharpcode">[Test]<span class="kwrd">public</span> <span class="kwrd">void</span> MockFormWithEvents(){MockManager.Init();<span class="rem">// Mock button so that we can...</span>Mock btnMock = MockManager.MockAll(<span class="kwrd">typeof</span>(Button));<span class="rem">// Handle all calls to add an event handler.</span>MockedEvent evntMock = btnMock.ExpectAddEventAlways(<span class="str">"Click"</span>);GUI frm = <span class="kwrd">new</span> GUI();frm.Initialize();evntMock.Fire(<span class="kwrd">this</span>, EventArgs.Empty);evntMock.Fire(<span class="kwrd">this</span>, EventArgs.Empty);evntMock.Fire(<span class="kwrd">this</span>, EventArgs.Empty);Assert.AreEqual(<span class="str">"LOVE!LOVE!LOVE!"</span>, frm.LovingCSharp);<span class="rem">// Ensure that all expectations were met.</span>MockManager.Verify();}}</pre><style type="text/css">.csharpcode, .csharpcode pre{	font-size: small;	color: black;	font-family: consolas, "Courier New", courier, monospace;	background-color: #ffffff;	/*white-space: pre;*/}.csharpcode pre { margin: 0em; }.csharpcode .rem { color: #008000; }.csharpcode .kwrd { color: #0000ff; }.csharpcode .str { color: #006080; }.csharpcode .op { color: #0000c0; }.csharpcode .preproc { color: #cc6633; }.csharpcode .asp { background-color: #ffff00; }.csharpcode .html { color: #800000; }.csharpcode .attr { color: #ff0000; }.csharpcode .alt {	background-color: #f4f4f4;	width: 100%;	margin: 0em;}.csharpcode .lnum { color: #606060; }</style><p><strong>Summary</strong></p><p>These are just two examples, and don't even delve into the whole "Natural Mocks" portion of TypeMock.&nbsp; Do yourself a favor, download the evaluation, they'll give you 30 days of all the features (which you can make any individual 30 days you'd like BTW) and ask yourself why you're jumping through all those hoops just to&nbsp; be able to mock dependencies.&nbsp; With this project, you don't have to create dependency injection constructors just to make your classes testable.</p>

---
title: "NProf saves the day..."
layout: post
---
<P>Today did not start as a good day.&nbsp; After considerable time in development (months), a major component of our project was put under load-test yesterday and left to run overnight.</P><P>The "load" in this case was a trivial load, a fraction of our daily business at the current time.&nbsp; That trivial amount of load took 11 hours to process, which I was informed at 8:30 AM this morning.&nbsp; I was not a happy architect.&nbsp; So with thousands of lines of code to consider, my first step was a manual quick-scan looking for blatant problems.&nbsp; In retrospect, I shouldn't have done this.&nbsp; It yielded some results, but missed the mark on the big issue (even if the DB access inside the component did have considerable problems).</P><P>So I went off in search of a profiling tool, something that could help me isolate the problem.&nbsp; Google resulted&nbsp;a top hit on <A href="http://nprof.sourceforge.net/Site/SiteHomeNews.html">NProf</A>, a link from <A href="http://www.larkware.com">Larkware</A> by Mike Gunderloy who I read religously where he had <A href="http://www.larkware.com/Articles/FreeNETProfiler.html">reviewed this tool</A>.&nbsp; I set it to work on a simple executable I wrote to create an isolated test of this component (yes, I had a Unit Test Library, no I didn't want to spend the time to figure out how to make it work with NUnit just then).&nbsp; The offending method popped up in the results very nicely, and has been slated for immediate refactoring tommorow.</P><P>Of particular note is that this profiler does not stop at calls to your code, but traces the entire framework during your application run.&nbsp; As such I know not only which method of mine is offending, but which of the methods it calls offends the most, etc, etc, etc.</P><P>As a side note, that code calls the String.get_Chars(int32) some 238 MILLION times in the course of it's 5 minute run.&nbsp; And that only accounted for 2.54 percent of the total time.</P>

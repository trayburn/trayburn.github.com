---
title: "Break the Habit : Nested If Statements"
layout: post
---
<p>It is time to break some bad habits, and today we take some code written by a man I like (but who will remain nameless and linkless) that is in desperate need of refactoring. But this problem is not a problem exclusive to this very bright developer, it is a bad habit that we as an industry have picked up somewhere along the line and I'm here to say "Stop The Insanity!". </p> <p>Consider the following code:<p></p> <div> <div class="csharpcode"><pre><span class="lnum"> 1:</span> <span class="kwrd">if</span> (_privateDataObject.Methodology != <span class="kwrd">null</span>)</pre><pre><span class="lnum"> 2:</span> { </pre><pre><span class="lnum"> 3:</span> <span class="kwrd">if</span> (_privateDataObject.Methodology == <span class="str">"00"</span>) </pre><pre><span class="lnum"> 4:</span> { </pre><pre><span class="lnum"> 5:</span> <span class="kwrd">if</span> (_privateDataObject.Amount != <span class="kwrd">null</span>)</pre><pre><span class="lnum"> 6:</span> { </pre><pre><span class="lnum"> 7:</span> <span class="kwrd">if</span> (IsNumeric(_privateDataObject.Amount)) </pre><pre><span class="lnum"> 8:</span> { </pre><pre><span class="lnum"> 9:</span> <span class="kwrd">if</span> (Convert.ToDecimal(_privateDataObject.Amount )==0 ) </pre><pre><span class="lnum">10:</span> { </pre><pre><span class="lnum">11:</span> bReturnValue =<span class="kwrd">true</span>; </pre><pre><span class="lnum">12:</span> } </pre><pre><span class="lnum">13:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">14:</span> { </pre><pre><span class="lnum">15:</span> </pre><pre><span class="lnum">16:</span> bReturnValue =<span class="kwrd">false</span>; </pre><pre><span class="lnum">17:</span> } </pre><pre><span class="lnum">18:</span> } </pre><pre><span class="lnum">19:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">20:</span> { </pre><pre><span class="lnum">21:</span> </pre><pre><span class="lnum">22:</span> bReturnValue =<span class="kwrd">false</span>; </pre><pre><span class="lnum">23:</span> } </pre><pre><span class="lnum">24:</span> } </pre><pre><span class="lnum">25:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">26:</span> { </pre><pre><span class="lnum">27:</span> </pre><pre><span class="lnum">28:</span> bReturnValue =<span class="kwrd">false</span>; </pre><pre><span class="lnum">29:</span> } </pre><pre><span class="lnum">30:</span> } </pre><pre><span class="lnum">31:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">32:</span> { </pre><pre><span class="lnum">33:</span> </pre><pre><span class="lnum">34:</span> bReturnValue =<span class="kwrd">false</span>; </pre><pre><span class="lnum">35:</span> } </pre><pre><span class="lnum">36:</span> } </pre><pre><span class="lnum">37:</span> &nbsp;</pre><pre><span class="lnum">38:</span> <span class="kwrd">return</span> bReturnValue;</pre></div><style type="text/css">.csharpcode-wrapper, .csharpcode-wrapper pre {background-color: #f4f4f4;border: solid 1px gray;cursor: text;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;margin: 20px 0px 10px 0px;max-height: 200px;overflow: auto;padding: 4px 4px 4px 4px;width: 97.5%;}.csharpcode-wrapper pre {border-style: none;margin: 0px 0px 0px 0px;overflow: visible;padding: 0px 0px 0px 0px;}.csharpcode, .csharpcode pre, .csharpcode .alt {background-color: #f4f4f4;border-style: none;color: black;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;overflow: visible;padding: 0px 0px 0px 0px;width: 100%;}.csharpcode pre {margin: 0em;}.csharpcode .alt {background-color: white;}.csharpcode .asp {background-color: #ffff00;}.csharpcode .attr {color: #ff0000;}.csharpcode .html {color: #800000;}.csharpcode .kwrd {color: #0000ff;}.csharpcode .lnum {color: #606060;}.csharpcode .op {color: #0000c0;}.csharpcode .preproc {color: #cc6633;}.csharpcode .rem {color: #008000;}.csharpcode .str {color: #006080;}</style></div><p>&nbsp;</p><p>This decision weighs in at over 38 lines. Let's look at what the warning signs in this method should have been that it needed to be coded differently. </p><p>The first and most important is that this follows a very basic pattern we see in code, we are seeking for single complex condition and want to return a "true" if we find it, and "false" in all other cases. This pattern is so basic it is taught in every Intro to Programming course ever. The pattern has a common name "Boolean AND" and is a part of every language (that I know of) on the planet. Refactored to accomidate for this pattern we end up with : <p>&nbsp; <div><div class="csharpcode"><pre><span class="lnum"> 1:</span> <span class="kwrd">if</span> (_privateDataObject.Methodology != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 2:</span> _privateDataObject.Methodology == <span class="str">"00"</span> &amp;&amp; </pre><pre><span class="lnum"> 3:</span> _privateDataObject.Amount != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 4:</span> IsNumeric(_privateDataObject.Amount) &amp;&amp; </pre><pre><span class="lnum"> 5:</span> Convert.ToDecimal(_privateDataObject.Amount ) == 0) </pre><pre><span class="lnum"> 6:</span> {</pre><pre><span class="lnum"> 7:</span> bReturnValue =<span class="kwrd">true</span>; </pre><pre><span class="lnum"> 8:</span> } </pre><pre><span class="lnum"> 9:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">10:</span> { </pre><pre><span class="lnum">11:</span> bReturnValue =<span class="kwrd">false</span>; </pre><pre><span class="lnum">12:</span> } </pre><pre><span class="lnum">13:</span> &nbsp;</pre><pre><span class="lnum">14:</span> <span class="kwrd">return</span> bReturnValue;</pre></div><style type="text/css">.csharpcode-wrapper, .csharpcode-wrapper pre {background-color: #f4f4f4;border: solid 1px gray;cursor: text;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;margin: 20px 0px 10px 0px;max-height: 200px;overflow: auto;padding: 4px 4px 4px 4px;width: 97.5%;}.csharpcode-wrapper pre {border-style: none;margin: 0px 0px 0px 0px;overflow: visible;padding: 0px 0px 0px 0px;}.csharpcode, .csharpcode pre, .csharpcode .alt {background-color: #f4f4f4;border-style: none;color: black;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;overflow: visible;padding: 0px 0px 0px 0px;width: 100%;}.csharpcode pre {margin: 0em;}.csharpcode .alt {background-color: white;}.csharpcode .asp {background-color: #ffff00;}.csharpcode .attr {color: #ff0000;}.csharpcode .html {color: #800000;}.csharpcode .kwrd {color: #0000ff;}.csharpcode .lnum {color: #606060;}.csharpcode .op {color: #0000c0;}.csharpcode .preproc {color: #cc6633;}.csharpcode .rem {color: #008000;}.csharpcode .str {color: #006080;}</style></div><p>From 38 lines down to 14, not bad. And this version is not even as short (in line count) as it could be in favor of readability (spreading the expression across multiple lines) and to include braces (which are optional with only 1 command). <p>Now that we've tamed the wild nested if, let's look at another problem. Why set a value, only to immediately return that value once you've decided on the result? Just return the value immediately. This small win nets us the following code: <div><div class="csharpcode"><pre><span class="lnum"> 1:</span> <span class="kwrd">if</span> (_privateDataObject.Methodology != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 2:</span> _privateDataObject.Methodology == <span class="str">"00"</span> &amp;&amp; </pre><pre><span class="lnum"> 3:</span> _privateDataObject.Amount != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 4:</span> IsNumeric(_privateDataObject.Amount) &amp;&amp; </pre><pre><span class="lnum"> 5:</span> Convert.ToDecimal(_privateDataObject.Amount ) == 0) </pre><pre><span class="lnum"> 6:</span> {</pre><pre><span class="lnum"> 7:</span> <span class="kwrd">return</span> <span class="kwrd">true</span>; </pre><pre><span class="lnum"> 8:</span> } </pre><pre><span class="lnum"> 9:</span> <span class="kwrd">else</span> </pre><pre><span class="lnum">10:</span> { </pre><pre><span class="lnum">11:</span> <span class="kwrd">return</span> <span class="kwrd">false</span>; </pre><pre><span class="lnum">12:</span> } </pre></div><style type="text/css">.csharpcode-wrapper, .csharpcode-wrapper pre {background-color: #f4f4f4;border: solid 1px gray;cursor: text;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;margin: 20px 0px 10px 0px;max-height: 200px;overflow: auto;padding: 4px 4px 4px 4px;width: 97.5%;}.csharpcode-wrapper pre {border-style: none;margin: 0px 0px 0px 0px;overflow: visible;padding: 0px 0px 0px 0px;}.csharpcode, .csharpcode pre, .csharpcode .alt {background-color: #f4f4f4;border-style: none;color: black;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;overflow: visible;padding: 0px 0px 0px 0px;width: 100%;}.csharpcode pre {margin: 0em;}.csharpcode .alt {background-color: white;}.csharpcode .asp {background-color: #ffff00;}.csharpcode .attr {color: #ff0000;}.csharpcode .html {color: #800000;}.csharpcode .kwrd {color: #0000ff;}.csharpcode .lnum {color: #606060;}.csharpcode .op {color: #0000c0;}.csharpcode .preproc {color: #cc6633;}.csharpcode .rem {color: #008000;}.csharpcode .str {color: #006080;}</style></div><p>From 14 to 12, not bad, and even less un-needed code. The final refactoring is based on the fact that this code is searching for a boolean value using boolean expressions. That means that to reach true "ruthless" refactoring we should end up with the following:</p><div>&nbsp;</div><div><div class="csharpcode"><pre><span class="lnum"> 1:</span> <span class="kwrd">return</span> _privateDataObject.Methodology != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 2:</span>_privateDataObject.Methodology == <span class="str">"00"</span> &amp;&amp; </pre><pre><span class="lnum"> 3:</span>_privateDataObject.Amount != <span class="kwrd">null</span> &amp;&amp;</pre><pre><span class="lnum"> 4:</span>IsNumeric(_privateDataObject.Amount) &amp;&amp; </pre><pre><span class="lnum"> 5:</span>Convert.ToDecimal(_privateDataObject.Amount ) == 0;</pre></div><style type="text/css">.csharpcode-wrapper, .csharpcode-wrapper pre {background-color: #f4f4f4;border: solid 1px gray;cursor: text;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;margin: 20px 0px 10px 0px;max-height: 200px;overflow: auto;padding: 4px 4px 4px 4px;width: 97.5%;}.csharpcode-wrapper pre {border-style: none;margin: 0px 0px 0px 0px;overflow: visible;padding: 0px 0px 0px 0px;}.csharpcode, .csharpcode pre, .csharpcode .alt {background-color: #f4f4f4;border-style: none;color: black;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;overflow: visible;padding: 0px 0px 0px 0px;width: 100%;}.csharpcode pre {margin: 0em;}.csharpcode .alt {background-color: white;}.csharpcode .asp {background-color: #ffff00;}.csharpcode .attr {color: #ff0000;}.csharpcode .html {color: #800000;}.csharpcode .kwrd {color: #0000ff;}.csharpcode .lnum {color: #606060;}.csharpcode .op {color: #0000c0;}.csharpcode .preproc {color: #cc6633;}.csharpcode .rem {color: #008000;}.csharpcode .str {color: #006080;}</style></div><p>Final result, 5 lines of code, same functionality. Important note to the Visual Basic developers out there, &amp;&amp; is the equivalent of "AndAlso" in VB, not simply "And", hence why this code does not blow up with a <a href="code://mscorlib:2.0.0.0:b77a5c561934e089/System.NullReferenceException">NullReferenceException</a>. </p><p>I implore every developer reading this to get into the habit of considering how to refactor code as soon as you've got it working, and I mean on a method by method basis. Even if you're not using a "TDD" methodology, this is a very good habit to get into because every time we change code we've introduced the chance to improve either the readability or performance of the code as well. It is natural to reach "working" code and want to move on, but spending 10 minutes to examine how you got it working will pay off in the long run, I assure you.</p>

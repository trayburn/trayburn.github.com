---
title: "Split() Function for SQL Server 2000"
layout: post
---
<script type="text/javascript"><!--google_ad_client = "pub-3977329255226857";//Banner Ads - Hot Articlesgoogle_ad_slot = "8482486806";google_ad_width = 468;google_ad_height = 60;google_cpa_choice = ""; // on file//--></script><script type="text/javascript"src="http://pagead2.googlesyndication.com/pagead/show_ads.js"></script><P><FONT size=2>This function was originally found at the following address:</FONT></P><P><FONT size=2><A href="http://msdn.microsoft.com/library/en-us/dnsqlmag01/html/treatyourselfListing_01.txt">http://msdn.microsoft.com/library/en-us/dnsqlmag01/html/treatyourselfListing_01.txt</A></FONT></P><P><FONT size=2>But strikes me as so utterly useful that I'm archiving here as an article just so that I have a copy when next I find myself in a situation where I need it.</FONT></P><P><FONT size=2>CREATE FUNCTION fn_Split(@sText varchar(8000), @sDelim varchar(20) = ' ')<BR>RETURNS @retArray TABLE (idx smallint Primary Key, value varchar(8000))<BR>AS<BR>BEGIN<BR>DECLARE @idx smallint,<BR>@value varchar(8000),<BR>@bcontinue bit,<BR>@iStrike smallint,<BR>@iDelimlength tinyint<BR><BR>IF @sDelim = 'Space'<BR>BEGIN<BR>SET @sDelim = ' '<BR>END<BR><BR>SET @idx = 0<BR>SET @sText = LTrim(RTrim(@sText))<BR>SET @iDelimlength = DATALENGTH(@sDelim)<BR>SET @bcontinue = 1<BR><BR>IF NOT ((@iDelimlength = 0) or (@sDelim = 'Empty'))<BR>BEGIN<BR>WHILE @bcontinue = 1<BR>BEGIN<BR><BR>--If you can find the delimiter in the text, retrieve the first element and<BR>--insert it with its index into the return table.<BR><BR>IF CHARINDEX(@sDelim, @sText)&gt;0<BR>BEGIN<BR>SET @value = SUBSTRING(@sText,1, CHARINDEX(@sDelim,@sText)-1)<BR>BEGIN<BR>INSERT @retArray (idx, value)<BR>VALUES (@idx, @value)<BR>END<BR><BR>--Trim the element and its delimiter from the front of the string.<BR>--Increment the index and loop.<BR>SET @iStrike = DATALENGTH(@value) + @iDelimlength<BR>SET @idx = @idx + 1<BR>SET @sText = LTrim(Right(@sText,DATALENGTH(@sText) - @iStrike))<BR><BR>END<BR>ELSE<BR>BEGIN<BR>--If you canâ€™t find the delimiter in the text, @sText is the last value in<BR>--@retArray.<BR>SET @value = @sText<BR>BEGIN<BR>INSERT @retArray (idx, value)<BR>VALUES (@idx, @value)<BR>END<BR>--Exit the WHILE loop.<BR>SET @bcontinue = 0<BR>END<BR>END<BR>END<BR>ELSE<BR>BEGIN<BR>WHILE @bcontinue=1<BR>BEGIN<BR>--If the delimiter is an empty string, check for remaining text<BR>--instead of a delimiter. Insert the first character into the<BR>--retArray table. Trim the character from the front of the string.<BR>--Increment the index and loop.<BR>IF DATALENGTH(@sText)&gt;1<BR>BEGIN<BR>SET @value = SUBSTRING(@sText,1,1)<BR>BEGIN<BR>INSERT @retArray (idx, value)<BR>VALUES (@idx, @value)<BR>END<BR>SET @idx = @idx+1<BR>SET @sText = SUBSTRING(@sText,2,DATALENGTH(@sText)-1)<BR><BR>END<BR>ELSE<BR>BEGIN<BR>--One character remains.<BR>--Insert the character, and exit the WHILE loop.<BR>INSERT @retArray (idx, value)<BR>VALUES (@idx, @sText)<BR>SET @bcontinue = 0 <BR>END<BR>END<BR><BR>END<BR><BR>RETURN<BR>END</FONT><BR><BR></P>

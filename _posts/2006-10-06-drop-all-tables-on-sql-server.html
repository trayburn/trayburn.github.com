---
title: "Drop All Tables on SQL Server"
layout: post
---
<p>I've recently been working on getting Community Server installed for another website and had the web installer get a Connection Timeout half way through the database creation.&nbsp; As such, I was looking for a quick way to scrub a database of all tables (dropping the whole database was not a convenient option).&nbsp; I looked around a bit on the web and <a href="http://www.thescripts.com/forum/thread79196.html">came up with this handy script</a>:</p> <p>IF DB_NAME() IN ('master', 'msdb', 'model', 'distribution')<br>BEGIN<br>RAISERROR('Not for use on system databases', 16, 1)<br>GOTO Done<br>END<br>SET NOCOUNT ON<br>DECLARE @DropStatement nvarchar(4000)<br>DECLARE @SequenceNumber int<br>DECLARE @LastError int<br>DECLARE @TablesDropped int<br>DECLARE DropStatements CURSOR LOCAL FAST_FORWARD READ_ONLY FOR<br>--views<br>SELECT<br>1 AS SequenceNumber,<br>N'DROP VIEW ' +<br>QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME) AS DropStatement<br>FROM<br>INFORMATION_SCHEMA.TABLES<br>WHERE<br>TABLE_TYPE = N'VIEW' AND<br>OBJECTPROPERTY(<br>OBJECT_ID(QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME)),<br>'IsSchemaBound') = 1 AND<br>OBJECTPROPERTY(<br>OBJECT_ID(QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME)),<br>'IsMSShipped') = 0<br>UNION ALL<br>--procedures and functions<br>SELECT<br>2 AS SequenceNumber,<br>N'DROP PROCEDURE ' +<br>QUOTENAME(ROUTINE_SCHEMA) +<br>N'.' +<br>QUOTENAME(ROUTINE_NAME) AS DropStatement<br>FROM<br>INFORMATION_SCHEMA.ROUTINES<br>WHERE<br>ROUTINE_TYPE = N'FUNCTION' AND<br>OBJECTPROPERTY(<br>OBJECT_ID(QUOTENAME(ROUTINE_SCHEMA) +<br>N'.' +<br>QUOTENAME(ROUTINE_NAME)),<br>'IsSchemaBound') = 1 AND<br>OBJECTPROPERTY(<br>OBJECT_ID(QUOTENAME(ROUTINE_SCHEMA) +<br>N'.' +<br>QUOTENAME(ROUTINE_NAME)),<br>'IsMSShipped') = 0<br>UNION ALL<br>--foreign keys<br>SELECT<br>3 AS SequenceNumber,<br>N'ALTER TABLE ' +<br>QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME) +<br>N' DROP CONSTRAINT ' +<br>CONSTRAINT_NAME AS DropStatement<br>FROM<br>INFORMATION_SCHEMA.TABLE_CONSTRAINTS<br>WHERE<br>CONSTRAINT_TYPE = N'FOREIGN KEY'<br>UNION ALL<br>--tables<br>SELECT<br>4 AS SequenceNumber,<br>N'DROP TABLE ' +<br>QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME) AS DropStatement<br>FROM<br>INFORMATION_SCHEMA.TABLES<br>WHERE<br>TABLE_TYPE = N'BASE TABLE' AND<br>OBJECTPROPERTY(<br>OBJECT_ID(QUOTENAME(TABLE_SCHEMA) +<br>N'.' +<br>QUOTENAME(TABLE_NAME)),<br>'IsMSShipped') = 0<br>ORDER BY SequenceNumber<br>OPEN DropStatements<br>WHILE 1 = 1<br>BEGIN<br>FETCH NEXT FROM DropStatements INTO @SequenceNumber, @DropStatement<br>IF @@FETCH_STATUS = -1 BREAK<br>BEGIN<br>RAISERROR('%s', 0, 1, @DropStatement) WITH NOWAIT<br>--EXECUTE sp_ExecuteSQL @DropStatement<br>SET @LastError = @@ERROR<br>IF @LastError &gt; 0<br>BEGIN<br>RAISERROR('Script terminated due to unexpected error', 16, 1)<br>GOTO Done<br>END<br>END<br>END<br>CLOSE DropStatements<br>DEALLOCATE DropStatements<br>Done:<br>GO</p>

---
title: "External File Dependency in NUnit"
layout: post
---
Of late I have been doing alot of work on NUnit, a popular open source Unit Testing framework.The area in which I have spent the most time is extending the available Assert models to accomplish new things.Today I finished and have sent in to be merged a FileAsserter which will compare, byte by byte, any file with any other file.The work is based on some work started by Darrel Norton which I extended and merged with the NUnit way of coding Asserters.In the process of writing the unit tests to support this functionality I found myself in the need to have external files which could move gracefully along with the test library.Easier said than done.<p>Fortunately for me I remember <a href="http://www.hanselman.com/blog/UsingNUnitAndABetterWayToUnitTestWithExternalFileDependancies.aspx">reading about a way to handle this some time ago on Scott Hanselman's blog</a>.He was in fact just quoting <a href="http://www.cauldwell.net/patrick/blog/PermaLink,guid,e9a1451b-108c-4da7-8be9-2b6c2316f7b1.aspx">Patrick Cauldwell</a>.Both of the variations of handling this were good, but not perfectly portable.I realized that this could be encapsulated into a re-usable component which implemented the IDisposable interface.This would allow me to use the using() statement and ensure that files were always cleaned up rather than accidently forgotten when you called only half of the routines presented by Scott or Patrick.So without further ado, here is my TestFile class.<p><font size=2>&nbsp;&nbsp;</font><font color="#0000FF" size=2>public <font color="#0000FF" size=2>class </font></font><font color="#008080" size=2>TestFile</font><font size=2> : </font><font color="#008080" size=2>IDisposable</font><br><font size=2>&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>private <font color="#0000FF" size=2>bool</font></font><font size=2> _disposedValue = </font><font color="#0000FF" size=2>false</font><font size=2>;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>private <font color="#0000FF" size=2>string</font></font><font size=2> _resourceName;<br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>private <font color="#0000FF" size=2>string</font></font><font size=2> _fileName;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>public</font><font size=2> TestFile(</font><font color="#0000FF" size=2>string</font><font size=2> fileName, </font><font color="#0000FF" size=2>string</font><font size=2> resourceName)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_resourceName = resourceName;<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_fileName = fileName;<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Assembly a = Assembly.GetExecutingAssembly();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>using</font><font size=2> (</font><font color="#008080" size=2>Stream</font><font size=2> s = a.GetManifestResourceStream(_resourceName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>if</font><font size=2> (s == </font><font color="#0000FF" size=2>null</font><font size=2>) </font><font color="#0000FF" size=2>throw <font color="#0000FF" size=2>new </font></font><font color="#008080" size=2>Exception</font><font size=2>(</font><font color="#800000" size=2>"Manifest Resource Stream "</font><font size=2> + _resourceName + </font><font color="#800000" size=2>" was not found."</font><font size=2>);<br><br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>using</font><font size=2> (</font><font color="#008080" size=2>StreamReader</font><font size=2> sr = </font><font color="#0000FF" size=2>new </font><font color="#008080" size=2>StreamReader</font><font size=2>(s))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>using</font><font size=2> (</font><font color="#008080" size=2>StreamWriter</font><font size=2> sw = </font><font color="#008080" size=2>File</font><font size=2>.CreateText(_fileName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sw.Write(sr.ReadToEnd());<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sw.Flush();<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;}<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>protected <font color="#0000FF" size=2>virtual <font color="#0000FF" size=2>void</font></font></font><font size=2> Dispose(</font><font color="#0000FF" size=2>bool</font><font size=2> disposing)<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>if</font><font size=2> (!</font><font color="#0000FF" size=2>this</font><font size=2>._disposedValue)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>if</font><font size=2> (disposing)<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>if</font><font size=2> (</font><font color="#008080" size=2>File</font><font size=2>.Exists(_fileName))<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#008080" size=2>File</font><font size=2>.Delete(_fileName);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>this</font><font size=2>._disposedValue = </font><font color="#0000FF" size=2>true</font><font size=2>;<br>&nbsp;&nbsp;&nbsp;&nbsp;}</font><br><br><font color="#0000FF" size=2>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000FF" size=2>#region</font></font><font size=2> IDisposable Members<br><br>&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#0000FF" size=2>public <font color="#0000FF" size=2>void</font></font><font size=2> Dispose()<br>&nbsp;&nbsp;&nbsp;&nbsp;{<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#008000" size=2>// Do not change this code.Put cleanup code in Dispose(bool disposing) above.</font><br><font size=2>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Dispose(</font><font color="#0000FF" size=2>true</font><font size=2>);<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</font><font color="#008080" size=2>GC</font><font size=2>.SuppressFinalize(</font><font color="#0000FF" size=2>this</font><font size=2>);<br>&nbsp;&nbsp;&nbsp;&nbsp;}</font><br><br><font color="#0000FF" size=2>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#0000FF" size=2>#endregion</font></font><br><font size=2>&nbsp;&nbsp;}</font>

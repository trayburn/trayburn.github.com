---
title: "LINQ Bug or Feature?"
layout: post
---
<p>So after many hours of downloading I've acquired the March CTP for Orcas and have it running both at home and at work under Virtual PC 2007.&nbsp; I decided to jump into LINQ as I'm entirely jazzed about this but one of my first few experiments with it, while a little unorthodox, has me scratching my head a bit.</p> <p>Consider if you will the following code, which retrieves a list of all files in the root folder of the C drive and then, using LINQ, selects a set of them at random using the FlipACoin method.&nbsp; Then I iterate through the list, outputting the contents of the results of my query ... or so I thought.</p> <p></p> <div> <div class="csharpcode"><pre class="alt"><span class="lnum"> 1:</span> <span class="kwrd">using</span> System;</pre><pre><span class="lnum"> 2:</span> <span class="kwrd">using</span> System.Linq;</pre><pre class="alt"><span class="lnum"> 3:</span> <span class="kwrd">using</span> System.Collections.Generic;</pre><pre><span class="lnum"> 4:</span> <span class="kwrd">using</span> System.Text;</pre><pre class="alt"><span class="lnum"> 5:</span> &nbsp;</pre><pre><span class="lnum"> 6:</span> <span class="kwrd">namespace</span> TestConsole07</pre><pre class="alt"><span class="lnum"> 7:</span> {</pre><pre><span class="lnum"> 8:</span> <span class="kwrd">class</span> Program</pre><pre class="alt"><span class="lnum"> 9:</span> {</pre><pre><span class="lnum">10:</span> <span class="kwrd">static</span> Random rnd = <span class="kwrd">new</span> Random();</pre><pre class="alt"><span class="lnum">11:</span> &nbsp;</pre><pre><span class="lnum">12:</span> <span class="kwrd">static</span> <span class="kwrd">void</span> Main(<span class="kwrd">string</span>[] args)</pre><pre class="alt"><span class="lnum">13:</span> {</pre><pre><span class="lnum">14:</span> var myList =</pre><pre class="alt"><span class="lnum">15:</span> from f <span class="kwrd">in</span> System.IO.Directory.GetFiles(<span class="str">@"C:\")</pre><pre><span class="lnum">16:</span> where FlipACoin()</pre><pre class="alt"><span class="lnum">17:</span> select System.IO.Path.GetFileName(f);</pre><pre><span class="lnum">18:</span> &nbsp;</pre><pre class="alt"><span class="lnum">19:</span> Console.WriteLine();</pre><pre><span class="lnum">20:</span> Console.WriteLine("</span>First Loop<span class="str">");</pre><pre class="alt"><span class="lnum">21:</span> Console.WriteLine("</span>-----------<span class="str">");</pre><pre><span class="lnum">22:</span> foreach (string loopFile in myList)</pre><pre class="alt"><span class="lnum">23:</span> {</pre><pre><span class="lnum">24:</span> Console.WriteLine(loopFile);</pre><pre class="alt"><span class="lnum">25:</span> }</pre><pre><span class="lnum">26:</span> &nbsp;</pre><pre class="alt"><span class="lnum">27:</span> Console.WriteLine();</pre><pre><span class="lnum">28:</span> Console.WriteLine("</span>Second Loop<span class="str">");</pre><pre class="alt"><span class="lnum">29:</span> Console.WriteLine("</span>-----------<span class="str">");</pre><pre><span class="lnum">30:</span> foreach (string loopFile in myList)</pre><pre class="alt"><span class="lnum">31:</span> {</pre><pre><span class="lnum">32:</span> Console.WriteLine(loopFile);</pre><pre class="alt"><span class="lnum">33:</span> }</pre><pre><span class="lnum">34:</span> &nbsp;</pre><pre class="alt"><span class="lnum">35:</span> Console.WriteLine();</pre><pre><span class="lnum">36:</span> Console.WriteLine("</span>Press Enter To Exit");</pre><pre class="alt"><span class="lnum">37:</span> Console.ReadLine();</pre><pre><span class="lnum">38:</span> }</pre><pre class="alt"><span class="lnum">39:</span> &nbsp;</pre><pre><span class="lnum">40:</span> <span class="kwrd">static</span> <span class="kwrd">bool</span> FlipACoin()</pre><pre class="alt"><span class="lnum">41:</span> {</pre><pre><span class="lnum">42:</span> <span class="kwrd">return</span> rnd.Next() &gt; (<span class="kwrd">int</span>.MaxValue / 2);</pre><pre class="alt"><span class="lnum">43:</span> }</pre><pre><span class="lnum">44:</span> }</pre><pre class="alt"><span class="lnum">45:</span> }</pre></div><style type="text/css">.csharpcode-wrapper, .csharpcode-wrapper pre {background-color: #f4f4f4;border: solid 1px gray;cursor: text;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;margin: 20px 0px 10px 0px;max-height: 200px;overflow: auto;padding: 4px 4px 4px 4px;width: 97.5%;}.csharpcode-wrapper pre {border-style: none;margin: 0px 0px 0px 0px;overflow: visible;padding: 0px 0px 0px 0px;}.csharpcode, .csharpcode pre, .csharpcode .alt {background-color: #f4f4f4;border-style: none;color: black;font-family: consolas, 'Courier New', courier, monospace;font-size: 8pt;line-height: 12pt;overflow: visible;padding: 0px 0px 0px 0px;width: 100%;}.csharpcode pre {margin: 0em;}.csharpcode .alt {background-color: white;}.csharpcode .asp {background-color: #ffff00;}.csharpcode .attr {color: #ff0000;}.csharpcode .html {color: #800000;}.csharpcode .kwrd {color: #0000ff;}.csharpcode .lnum {color: #606060;}.csharpcode .op {color: #0000c0;}.csharpcode .preproc {color: #cc6633;}.csharpcode .rem {color: #008000;}.csharpcode .str {color: #006080;}</style></div><p>When this code is executed, what happens is very odd.&nbsp; Here is the output from a sample run:</p><blockquote><p><font face="Courier New">First Loop<br>----------<br>AUTOEXEC.BAT<br>eula.1033.txt<br>install.ini<br>install.res.1033.dll<br>MSDOS.SYS<br>NTDETECT.COM<br>ntldr<br>pagefile.sys<br>sde.bmp<br>SDE_VSD.MSI<br>unicows.dll </font></p><p><font face="Courier New">Second Loop<br>-----------<br>boot.ini<br>CONFIG.SYS<br>install.exe<br>install.ini<br>install.res.1033.dll<br>NTDETECT.COM<br>SDE_VSD.MSI<br>unicows.dll </font><p><font face="Courier New">Press Enter To Exit</font></p></blockquote><p>Notice that despite the fact that I'm iterating over the same list each time, the files listed are different.&nbsp; This means that each time I begin to iterate over the list the LINQ "query" is being executed again, and a new set of values are being returned from FlipACoin. <p>I can undoubtedly say this wasn't what I expected, but what I can't seem to determine is if this is a feature of LINQ or if this is a bug.&nbsp; My first response would be bug, but that is because whenever I believe I've expressed my intent clearly and don't get the response I expect, I call that a bug. <p>What do you think?&nbsp; Is this just a cool feature that won't come up very often? Or is this a dent in the armor of LINQ? 
